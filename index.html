<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“‹ Kiá»ƒm KÃª MÃ¡y May - VÄ©nh HÆ°ng</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f3f6f9; }
  h2 { background: #2e86de; color: #fff; padding: 10px 20px; margin: 0; }
  .container { padding: 20px; }
  button { padding: 6px 12px; border: none; background: #2e86de; color: white; border-radius: 4px; cursor: pointer; }
  button:hover { background: #1b4f9c; }
  input, select { padding: 5px; border: 1px solid #ccc; border-radius: 4px; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
  th { background: #e9ecef; }
  .actions button { margin-right: 4px; }
  .success { color: green; font-weight: bold; }
  .error { color: red; font-weight: bold; }
  #msg { margin-top: 10px; }
  #importInput { display: none; }
</style>
</head>
<body>
  <h2>ğŸ“‹ Quáº£n LÃ½ Kiá»ƒm KÃª MÃ¡y May</h2>
  <div class="container">

    <div style="margin-bottom:10px;">
      <button onclick="syncData()">ğŸ”„ Äá»“ng bá»™ tá»« Google Sheet</button>
      <button onclick="addRow()">â• ThÃªm dÃ²ng</button>
      <button onclick="exportExcel()">â¬‡ï¸ Xuáº¥t Excel</button>
      <button onclick="document.getElementById('importInput').click()">â¬†ï¸ Nháº­p Excel</button>
      <input type="file" id="importInput" accept=".xlsx" onchange="importExcel(event)">
    </div>

    <div>
      <label>TÃ¬m kiáº¿m: </label>
      <input type="text" id="searchBox" oninput="renderTable()" placeholder="Nháº­p sá»‘ tháº», sá»‘ mÃ¡y hoáº·c vá»‹ trÃ­...">
    </div>

    <div id="msg"></div>

    <table id="dataTable">
      <thead>
        <tr>
          <th>Sá»‘ tháº»</th>
          <th>Sá»‘ mÃ¡y</th>
          <th>Loáº¡i mÃ¡y</th>
          <th>Vá»‹ trÃ­</th>
          <th>Ghi chÃº</th>
          <th>Thao tÃ¡c</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.19.3/xlsx.full.min.js"></script>
<script>
const GAS_URL = 'https://script.google.com/macros/s/AKfycbyV36oZEfMdC7Hc2EOqVL5r2A6qMPWvo5sU3qUdDhxbQ1hMPzwSYgdGnXPioOeZeWVs/exec';
let data = [];

async function syncData() {
  const msg = document.getElementById('msg');
  msg.textContent = 'â³ Äang táº£i dá»¯ liá»‡u...';
  msg.className = '';
  try {
    const res = await fetch(GAS_URL);
    const json = await res.json();
    if (json.success && Array.isArray(json.data)) {
      data = json.data;
      renderTable();
      msg.textContent = 'âœ… Äá»“ng bá»™ thÃ nh cÃ´ng!';
      msg.className = 'success';
    } else {
      throw new Error('Dá»¯ liá»‡u tráº£ vá» khÃ´ng há»£p lá»‡');
    }
  } catch (err) {
    msg.textContent = 'âŒ KhÃ´ng thá»ƒ káº¿t ná»‘i tá»›i GAS: ' + err.message;
    msg.className = 'error';
  }
}

function renderTable() {
  const tbody = document.querySelector('#dataTable tbody');
  tbody.innerHTML = '';
  const keyword = document.getElementById('searchBox').value.toLowerCase();
  const filtered = data.filter(row =>
    Object.values(row).some(v => String(v).toLowerCase().includes(keyword))
  );

  filtered.forEach((row, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td contenteditable oninput="updateField(${i}, 'soThe', this.innerText)">${row.soThe}</td>
      <td contenteditable oninput="updateField(${i}, 'soMay', this.innerText)">${row.soMay}</td>
      <td contenteditable oninput="updateField(${i}, 'loaiMay', this.innerText)">${row.loaiMay}</td>
      <td contenteditable oninput="updateField(${i}, 'viTri', this.innerText)">${row.viTri}</td>
      <td contenteditable oninput="updateField(${i}, 'ghiChu', this.innerText)">${row.ghiChu}</td>
      <td class="actions">
        <button onclick="deleteRow(${i})">ğŸ—‘ï¸ XÃ³a</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function updateField(index, field, value) {
  data[index][field] = value;
}

function addRow() {
  data.push({ soThe: '', soMay: '', loaiMay: '', viTri: '', ghiChu: '' });
  renderTable();
}

function deleteRow(index) {
  if (confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a dÃ²ng nÃ y?')) {
    data.splice(index, 1);
    renderTable();
  }
}

// Xuáº¥t Excel
function exportExcel() {
  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "DanhSachMay");
  XLSX.writeFile(wb, "DanhSachMay.xlsx");
}

// Nháº­p Excel
function importExcel(evt) {
  const file = evt.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    const wb = XLSX.read(e.target.result, { type: 'binary' });
    const ws = wb.Sheets[wb.SheetNames[0]];
    data = XLSX.utils.sheet_to_json(ws);
    renderTable();
  };
  reader.readAsBinaryString(file);
}
</script>
</body>
</html>
