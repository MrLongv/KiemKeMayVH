<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>üìã Ki·ªÉm k√™ m√°y Vi·ªát H·ªìng</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body{font-family:Arial,sans-serif;margin:0;background:#f4f6f8}
header{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:#0b74d1;color:#fff;font-weight:bold}
.controls{padding:10px 20px;display:flex;gap:10px;flex-wrap:wrap}
.table-wrap{overflow-x:auto;margin:10px 20px}
table{border-collapse:collapse;width:100%;min-width:800px}
th,td{border:1px solid #ccc;padding:6px;text-align:left}
th{background:#eee}
.clamp-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.modal-open{overflow:hidden;position:fixed;width:100%}
#editModal{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;display:none}
#editModal .modal-content{background:#fff;padding:20px;border-radius:8px;width:400px;max-height:90%;overflow-y:auto;display:flex;flex-direction:column;gap:6px}
#editModal label{font-weight:bold;margin-top:6px}
#editModal input, #editModal textarea{width:100%;padding:6px;box-sizing:border-box}
#editModal .actions{display:flex;justify-content:flex-end;gap:10px;margin-top:10px}
.highlight-row{background:#fffa9c !important}
</style>
</head>
<body>

<header>üìã Ki·ªÉm k√™ m√°y Vi·ªát H·ªìng</header>

<div class="controls">
  <input id="searchBox" placeholder="T√¨m ki·∫øm..." style="flex:1;padding:6px"/>
  <select id="filterBox">
    <option value="">T·∫•t c·∫£</option>
    <option value="daKiemKe">ƒê√£ ki·ªÉm k√™</option>
    <option value="chuaKiemKe">Ch∆∞a ki·ªÉm k√™</option>
    <option value="daIn">ƒê√£ in QR</option>
    <option value="chuaIn">Ch∆∞a in QR</option>
  </select>
  <button id="btnAdd">‚ûï Th√™m m·ªõi</button>
  <button id="btnSync">üíæ ƒê·ªìng b·ªô</button>
  <button id="btnRefresh">üîÑ T·∫£i l·∫°i</button>
  <button id="btnPrint">üñ® In QR</button>
  <button id="btnPrintLyLich">üñ® In l√Ω l·ªãch</button>
  <input id="soThePrint" placeholder="S·ªë th·∫ª (ho·∫∑c all)" style="width:150px;padding:6px"/>
</div>

<div id="searchInfo" style="margin:0 20px 10px 20px;">T√¨m th·∫•y 0 d√≤ng</div>

<div class="table-wrap">
  <table id="dataTable">
    <thead>
      <tr>
        <th>#</th>
        <th>S·ªë th·∫ª</th>
        <th>S·ªë m√°y</th>
        <th>Lo·∫°i m√°y</th>
        <th>V·ªã tr√≠</th>
        <th>Ghi ch√∫</th>
        <th>H√†nh ƒë·ªông</th>
        <th>ƒê√£ KK <input type="checkbox" id="checkAllKK"></th>
        <th>In QR <input type="checkbox" id="checkAllQR"></th>
        <th>Ng√†y mua</th>
        <th>N∆°i mua</th>
        <th>Q1 <input type="checkbox" id="checkAllQ1"></th>
        <th>Q2 <input type="checkbox" id="checkAllQ2"></th>
        <th>Q3 <input type="checkbox" id="checkAllQ3"></th>
        <th>Q4 <input type="checkbox" id="checkAllQ4"></th>
        <th>S·ª≠a ch·ªØa</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- MODAL -->
<div id="editModal">
  <div class="modal-content">
    <label>S·ªë th·∫ª</label>
    <input id="m_soThe">
    <label>S·ªë m√°y</label>
    <input id="m_soMay">
    <label>Lo·∫°i m√°y</label>
    <input id="m_loaiMay">
    <label>V·ªã tr√≠</label>
    <input id="m_viTri">
    <label>Ghi ch√∫</label>
    <textarea id="m_ghiChu" rows="2"></textarea>
    <label>ƒê√£ ki·ªÉm k√™ <input type="checkbox" id="m_daKiemKe"></label>
    <label>In QR <input type="checkbox" id="m_chonIn"></label>
    <label>Ng√†y mua</label>
    <input type="date" id="m_ngayMua">
    <label>N∆°i mua</label>
    <input id="m_noiMua">
    <label>B·∫£o d∆∞·ª°ng Q1</label>
    <input type="checkbox" id="m_bdQ1"> <input type="date" id="m_bdQ1_ngay">
    <label>B·∫£o d∆∞·ª°ng Q2</label>
    <input type="checkbox" id="m_bdQ2"> <input type="date" id="m_bdQ2_ngay">
    <label>B·∫£o d∆∞·ª°ng Q3</label>
    <input type="checkbox" id="m_bdQ3"> <input type="date" id="m_bdQ3_ngay">
    <label>B·∫£o d∆∞·ª°ng Q4</label>
    <input type="checkbox" id="m_bdQ4"> <input type="date" id="m_bdQ4_ngay">
    <label>S·ª≠a ch·ªØa</label>
    <textarea id="m_suaChua" rows="3" placeholder="Ghi n·ªôi dung s·ª≠a ch·ªØa"></textarea>

    <div class="actions">
      <button id="cancelBtn" class="ghost">H·ªßy</button>
      <button id="saveBtn">C·∫≠p nh·∫≠t</button>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
const WORKER_URL = 'https://snowy-surf-e985.hoalangiongxoai.workers.dev'; // thay b·∫±ng URL Worker c·ªßa b·∫°n

const statusEl=document.getElementById('searchInfo');
const tbody=document.querySelector('#dataTable tbody');
const filterBox=document.getElementById('filterBox'), searchBox=document.getElementById('searchBox');
const modal=document.getElementById('editModal');
const m_soThe=document.getElementById('m_soThe'), m_soMay=document.getElementById('m_soMay'),
      m_loaiMay=document.getElementById('m_loaiMay'), m_viTri=document.getElementById('m_viTri'),
      m_ghiChu=document.getElementById('m_ghiChu'), m_daKiemKe=document.getElementById('m_daKiemKe'),
      m_chonIn=document.getElementById('m_chonIn'), m_ngayMua=document.getElementById('m_ngayMua'),
      m_noiMua=document.getElementById('m_noiMua'),
      m_bdQ1=document.getElementById('m_bdQ1'), m_bdQ2=document.getElementById('m_bdQ2'),
      m_bdQ3=document.getElementById('m_bdQ3'), m_bdQ4=document.getElementById('m_bdQ4'),
      m_bdQ1_ngay=document.getElementById('m_bdQ1_ngay'),
      m_bdQ2_ngay=document.getElementById('m_bdQ2_ngay'),
      m_bdQ3_ngay=document.getElementById('m_bdQ3_ngay'),
      m_bdQ4_ngay=document.getElementById('m_bdQ4_ngay'),
      m_suaChua=document.getElementById('m_suaChua');

let allData=[], editingIndex=null;

function setStatus(txt,ok=true){statusEl.innerText=txt;statusEl.style.color=ok?'#0b74d1':'#c0392b';}
function safeText(v){return v==null?'':String(v);}
function formatDateDDMMYYYY(d){
  if(!d) return ''; 
  if(d.includes('/')) return d;
  const [y,m,day] = d.split('-'); return `${day}/${m}/${y}`;
}

// ===== LOAD DATA t·ª´ Worker =====
async function loadData(){
  try{
    setStatus('ƒêang t·∫£i d·ªØ li·ªáu...');
    const res = await fetch(WORKER_URL);
    const data = await res.json();
    if(data.success && Array.isArray(data.data)){
      allData = data.data;
      renderTable();
      setStatus('ƒê√£ t·∫£i '+allData.length+' d√≤ng');
    }else setStatus('L·ªói t·∫£i d·ªØ li·ªáu',false);
  }catch(e){
    setStatus('L·ªói t·∫£i d·ªØ li·ªáu',false);
    console.error(e);
  }
}

// ===== AUTO SYNC ROW l√™n Worker =====
async function autoSyncRow(idx){
  if(idx==null || !allData[idx]) return;
  try{
    const rowData = allData[idx];
    const res = await fetch(WORKER_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify([rowData])
    });
    const data = await res.json();
    if(data.success) setStatus('‚úÖ ƒê√£ l∆∞u d√≤ng '+(idx+1));
    else setStatus('‚ùå L·ªói l∆∞u d√≤ng '+(idx+1),false);
  }catch(e){console.error(e); setStatus('‚ùå L·ªói l∆∞u d√≤ng '+(idx+1),false);}
}

// ===== RENDER TABLE =====
function renderTable(){
  tbody.innerHTML='';
  const filter = filterBox.value;
  const search = (searchBox.value||'').toLowerCase();
  let countVisible =0;
  allData.forEach((r,idx)=>{
    let show=true;
    if(filter==='daKiemKe' && !r.daKiemKe) show=false;
    if(filter==='chuaKiemKe' && r.daKiemKe) show=false;
    if(filter==='daIn' && !r.chonIn) show=false;
    if(filter==='chuaIn' && r.chonIn) show=false;
    if(search){
      const haystack=[r.soThe,r.soMay,r.loaiMay,r.viTri,r.ghiChu,r.noiMua,r.ngayMua,r.suaChua].map(x=>safeText(x).toLowerCase()).join(' ');
      if(!haystack.includes(search)) show=false;
    }
    if(show){
      countVisible++;
      const tr=document.createElement('tr');
      tr.dataset.index=idx;
      tr.innerHTML=`
        <td>${idx+1}</td>
        <td class="col-so-the">${safeText(r.soThe)}</td>
        <td>${safeText(r.soMay)}</td>
        <td>${safeText(r.loaiMay)}</td>
        <td>${safeText(r.viTri)}</td>
        <td>${safeText(r.ghiChu)}</td>
        <td>
          <button data-act="edit" data-i="${idx}">‚úèÔ∏è</button>
          <button data-act="qr" data-i="${idx}">üîó</button>
        </td>
        <td><input type="checkbox" class="daKiemKe" ${r.daKiemKe?'checked':''}></td>
        <td><input type="checkbox" class="chonIn" ${r.chonIn?'checked':''}></td>
        <td>${r.ngayMua||''}</td>
        <td>${r.noiMua||''}</td>
        <td><input type="checkbox" class="bdQ1" ${r.bdQ1?'checked':''}></td>
        <td><input type="checkbox" class="bdQ2" ${r.bdQ2?'checked':''}></td>
        <td><input type="checkbox" class="bdQ3" ${r.bdQ3?'checked':''}></td>
        <td><input type="checkbox" class="bdQ4" ${r.bdQ4?'checked':''}></td>
        <td>${safeText(r.suaChua)}</td>
      `;
      tbody.appendChild(tr);
    }
  });
  setStatus(`T√¨m th·∫•y ${countVisible} d√≤ng`);
}

// ===== EVENTS =====
filterBox.addEventListener('change',renderTable);
searchBox.addEventListener('input',renderTable);

tbody.addEventListener('click',e=>{
  const btn=e.target.closest('button'); if(!btn) return;
  const act=btn.dataset.act, i=Number(btn.dataset.i);
  if(act==='edit') openEditModal(i);
  if(act==='qr'){ 
    const code=encodeURIComponent(allData[i].soThe||''); 
    const url=location.href.split('#')[0]+'#'+code;
    prompt('Link QR (copy & in tem):',url);
  }
});

// checkbox changes
tbody.addEventListener('change',e=>{
  const tr=e.target.closest('tr'); if(!tr) return;
  const idx=Number(tr.dataset.index);
  if(e.target.classList.contains('daKiemKe')){ allData[idx].daKiemKe=e.target.checked; autoSyncRow(idx); }
  if(e.target.classList.contains('chonIn')){ allData[idx].chonIn=e.target.checked; autoSyncRow(idx); }
  if(e.target.classList.contains('bdQ1')){ allData[idx].bdQ1=e.target.checked; autoSyncRow(idx); }
  if(e.target.classList.contains('bdQ2')){ allData[idx].bdQ2=e.target.checked; autoSyncRow(idx); }
  if(e.target.classList.contains('bdQ3')){ allData[idx].bdQ3=e.target.checked; autoSyncRow(idx); }
  if(e.target.classList.contains('bdQ4')){ allData[idx].bdQ4=e.target.checked; autoSyncRow(idx); }
  renderTable();
});

// ===== MODAL =====
let lastScrollY=0;
function openEditModal(idx){
  lastScrollY = window.scrollY;
  modal.style.display='flex';
  document.body.classList.add('modal-open');
  document.body.style.top=`-${window.scrollY}px`;

  if(idx==null){
    editingIndex=null;
    m_soThe.value=''; m_soMay.value=''; m_loaiMay.value=''; m_viTri.value=''; m_ghiChu.value='';
    m_daKiemKe.checked=false; m_chonIn.checked=false; m_ngayMua.value=''; m_noiMua.value='';
    m_bdQ1.checked=false; m_bdQ2.checked=false; m_bdQ3.checked=false; m_bdQ4.checked=false;
    m_bdQ1_ngay.value=''; m_bdQ2_ngay.value=''; m_bdQ3_ngay.value=''; m_bdQ4_ngay.value='';
    m_suaChua.value='';
  } else {
    editingIndex=idx;
    const r=allData[idx];
    m_soThe.value=r.soThe||''; m_soMay.value=r.soMay||''; m_loaiMay.value=r.loaiMay||''; m_viTri.value=r.viTri||''; m_ghiChu.value=r.ghiChu||'';
    m_daKiemKe.checked=!!r.daKiemKe; m_chonIn.checked=!!r.chonIn; m_ngayMua.value=r.ngayMua||''; m_noiMua.value=r.noiMua||'';
    m_bdQ1.checked=!!r.bdQ1; m_bdQ2.checked=!!r.bdQ2; m_bdQ3.checked=!!r.bdQ3; m_bdQ4.checked=!!r.bdQ4;
    m_bdQ1_ngay.value=r.bdQ1_ngay||''; m_bdQ2_ngay.value=r.bdQ2_ngay||''; m_bdQ3_ngay.value=r.bdQ3_ngay||''; m_bdQ4_ngay.value=r.bdQ4_ngay||'';
    m_suaChua.value=r.suaChua||'';
  }
  m_soThe.focus();
}

function closeModal(){
  modal.style.display='none';
  editingIndex=null;
  document.body.classList.remove('modal-open');
  document.body.style.top='';
  window.scrollTo(0,lastScrollY);
}
document.getElementById('cancelBtn').onclick=closeModal;

// ===== SAVE =====
document.getElementById('saveBtn').onclick=()=>{
  const hasData=m_soThe.value.trim()||m_soMay.value.trim();
  if(editingIndex==null && !hasData){ alert('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ th√™m!'); return; }
  const row={
    soThe:m_soThe.value, soMay:m_soMay.value, loaiMay:m_loaiMay.value, viTri:m_viTri.value, ghiChu:m_ghiChu.value,
    daKiemKe:m_daKiemKe.checked, chonIn:m_chonIn.checked, ngayMua:m_ngayMua.value, noiMua:m_noiMua.value,
    bdQ1:m_bdQ1.checked, bdQ2:m_bdQ2.checked, bdQ3:m_bdQ3.checked, bdQ4:m_bdQ4.checked,
    bdQ1_ngay:m_bdQ1_ngay.value, bdQ2_ngay:m_bdQ2_ngay.value, bdQ3_ngay:m_bdQ3_ngay.value, bdQ4_ngay:m_bdQ4_ngay.value,
    suaChua:m_suaChua.value
  };
  if(editingIndex==null){ allData.push(row); autoSyncRow(allData.length-1); }
  else { allData[editingIndex]=row; autoSyncRow(editingIndex); }
  renderTable(); closeModal();
};

// ===== INIT =====
loadData();
document.getElementById('btnAdd
document.getElementById('btnAdd').onclick=()=>openEditModal(null);

// ===== CHECK/UNCHECK TO√ÄN B·ªò =====
document.getElementById("checkAllKK").addEventListener("change", function() {
  document.querySelectorAll(".daKiemKe").forEach(cb=>{
    cb.checked=this.checked;
    const idx=Number(cb.closest("tr").dataset.index);
    allData[idx].daKiemKe=this.checked;
    autoSyncRow(idx);
  });
  renderTable();
});

document.getElementById("checkAllQR").addEventListener("change", function() {
  document.querySelectorAll(".chonIn").forEach(cb=>{
    cb.checked=this.checked;
    const idx=Number(cb.closest("tr").dataset.index);
    allData[idx].chonIn=this.checked;
    autoSyncRow(idx);
  });
  renderTable();
});

document.getElementById("checkAllQ1").addEventListener("change", function() {
  document.querySelectorAll(".bdQ1").forEach(cb=>{
    cb.checked=this.checked;
    const idx=Number(cb.closest("tr").dataset.index);
    allData[idx].bdQ1=this.checked;
    autoSyncRow(idx);
  });
  renderTable();
});
document.getElementById("checkAllQ2").addEventListener("change", function() {
  document.querySelectorAll(".bdQ2").forEach(cb=>{
    cb.checked=this.checked;
    const idx=Number(cb.closest("tr").dataset.index);
    allData[idx].bdQ2=this.checked;
    autoSyncRow(idx);
  });
  renderTable();
});
document.getElementById("checkAllQ3").addEventListener("change", function() {
  document.querySelectorAll(".bdQ3").forEach(cb=>{
    cb.checked=this.checked;
    const idx=Number(cb.closest("tr").dataset.index);
    allData[idx].bdQ3=this.checked;
    autoSyncRow(idx);
  });
  renderTable();
});
document.getElementById("checkAllQ4").addEventListener("change", function() {
  document.querySelectorAll(".bdQ4").forEach(cb=>{
    cb.checked=this.checked;
    const idx=Number(cb.closest("tr").dataset.index);
    allData[idx].bdQ4=this.checked;
    autoSyncRow(idx);
  });
  renderTable();
});

// ===== REFRESH =====
document.getElementById('btnRefresh').onclick=loadData;

// ===== IN QR =====
document.getElementById('btnPrint').onclick=()=>{
  const printData=allData.filter(r=>r.chonIn);
  if(printData.length===0){ alert('Ch·ªçn √≠t nh·∫•t 1 d√≤ng ƒë·ªÉ in'); return; }

  const w=window.open('','_blank');
  w.document.write('<html><head><title>In Tem QR</title><style>');
  w.document.write(`
    @page{size:A4 portrait;margin:4.3mm}
    body{font-family:Arial,sans-serif;margin:0;padding:0;display:grid;grid-template-columns:repeat(5,1fr);grid-auto-rows:auto;gap:2mm;justify-items:center;align-items:center}
    .tem{width:32mm;height:34mm;border:0.1px solid #000;border-radius:0.2px;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:0.1mm;box-sizing:border-box;text-align:center;page-break-inside:avoid}
    .tem .top{font-weight:bold;font-size:12px;margin:0.2mm 0}
    .tem .qr{margin:0;padding:0;line-height:0}
    .tem .bottom{font-weight:bold;font-size:12px;margin:0.2mm 0 0.1mm 0}
    canvas{display:block;margin:0;width:76px !important;height:76px !important}
  `);
  w.document.write('</style></head><body>');
  printData.forEach(r=>{
    const code=encodeURIComponent(r.soThe||'');
    w.document.write(`
      <div class="tem">
        <div class="top">VH-${r.soThe}</div>
        <div class="qr" id="qr_${code}"></div>
        <div class="bottom">SM: ${r.soMay||''}</div>
      </div>
    `);
  });
  w.document.write('</body></html>');
  w.document.close();
  w.onload=()=>{
    printData.forEach(r=>{
      const code=encodeURIComponent(r.soThe||'');
      const qrDiv=w.document.getElementById('qr_'+code);
      if(qrDiv){
        new QRCode(qrDiv,{
          text: location.href.split('#')[0]+'#'+code,
          width:90,
          height:90
        });
      }
    });
    setTimeout(()=>{w.focus(); w.print();},500);
  };
};

// ===== IN L√ù L·ªäCH =====
document.getElementById('btnPrintLyLich').onclick=()=>{
  const input=document.getElementById('soThePrint').value.trim();
  if(!input){ alert("Nh·∫≠p s·ªë th·∫ª ho·∫∑c g√µ 'all' ƒë·ªÉ in to√†n b·ªô!"); return; }

  let listSoThe=[];
  if(input.toLowerCase()==='all'){ listSoThe=allData.map(r=>r.soThe); }
  else { listSoThe=input.split(',').map(s=>s.trim()).filter(s=>s); }

  if(listSoThe.length===0){ alert("Kh√¥ng c√≥ s·ªë th·∫ª h·ª£p l·ªá."); return; }

  const baseURL=location.href.split('#')[0];
  const w=window.open('','_blank');
  w.document.write('<html><head><title>In L√Ω L·ªãch</title><style>');
  w.document.write(`
    body{font-family:Arial;margin:20px;color:#333}
    .header-logo div{font-size:20px;font-weight:bold;line-height:1.2}
    h2{text-align:center;font-size:22px;border-bottom:2px solid #333;padding-bottom:8px;margin-bottom:10px}
    table{border-collapse:collapse;width:100%;margin-top:10px}
    th,td{border:1px solid #ccc;padding:8px}
    th{background:#eee;width:30%}
    .page-break{page-break-after:always}
    .sign-box{margin-top:10px;text-align:right;font-size:16px;line-height:1.5}
    .sign1{margin-right:30px}
    .sign2{margin-right:60px}
  `);
  w.document.write('</style></head><body>');

  listSoThe.forEach((soThe,idx)=>{
    const row=allData.find(r=>r.soThe==soThe);
    if(!row){ w.document.write(`<h3 style="color:red">‚ö† Kh√¥ng t√¨m th·∫•y s·ªë th·∫ª: ${soThe}</h3><div class="page-break"></div>`); return; }
    const tempDiv=document.createElement("div");
    new QRCode(tempDiv,{text:baseURL+'#'+encodeURIComponent(soThe),width:100,height:100});
    const qrImg=tempDiv.querySelector("img")?.src || tempDiv.querySelector("canvas")?.toDataURL();

    w.document.write(`
      <div class="header-logo">
        <div style="margin-left:0px;">C√îNG TY TNHH MAY XK</div>
        <div style="margin-left:55px;">VI·ªÜT H·ªíNG</div>
      </div>
      <div style="position: relative; margin-bottom: 40px;">
        <div style="position: absolute; left:60px; top:0;">
          <img src="${qrImg}" style="width:100px;height:100px;">
        </div>
        <div style="text-align:center; font-size:20px; font-weight:bold; padding-top:60px;">
          L√ù L·ªäCH M√ÅY VH-${soThe}
        </div>
      </div>
      <table>
        <tr><th>S·ªë th·∫ª</th><td>${row.soThe}</td></tr>
        <tr><th>S·ªë m√°y</th><td>${row.soMay}</td></tr>
        <tr><th>Lo·∫°i m√°y</th><td>${row.loaiMay}</td></tr>
        <tr><th>V·ªã tr√≠</th><td>${row.viTri}</td></tr>
        <tr><th>Ghi ch√∫</th><td>${row.ghiChu}</td></tr>
        <tr><th>ƒê√£ ki·ªÉm k√™</th><td>${row.daKiemKe?'‚úÖ':'‚ùå'}</td></tr>
        <tr><th>In QR</th><td>${row.chonIn?'‚úÖ':'‚ùå'}</td></tr>
        <tr><th>Ng√†y mua</th><td>${row.ngayMua||''}</td></tr>
        <tr><th>N∆°i mua</th><td>${row.noiMua||''}</td></tr>
        <tr><th>B·∫£o d∆∞·ª°ng Q1</th><td>${row.bdQ1?'‚úÖ':''} ${row.bdQ1_ngay||''}</td></tr>
        <tr><th>B·∫£o d∆∞·ª°ng Q2</th><td>${row.bdQ2?'‚úÖ':''} ${row.bdQ2_ngay||''}</td></tr>
        <tr><th>B·∫£o d∆∞·ª°ng Q3</th><td>${row.bdQ3?'‚úÖ':''} ${row.bdQ3_ngay||''}</td></tr>
        <tr><th>B·∫£o d∆∞·ª°ng Q4</th><td>${row.bdQ4?'‚úÖ':''} ${row.bdQ4_ngay||''}</td></tr>
        <tr><th>S·ª≠a ch·ªØa</th><td>${row.suaChua||''}</td></tr>
      </table>
      <div class="sign-box">
        <div class="sign1">Vƒ©nh Long, ng√†y ..... th√°ng ..... nƒÉm .....</div>
        <div class="sign2">Ng∆∞·ªùi l·∫≠p</div>
      </div>
    `);

    if(idx<listSoThe.length-1) w.document.write('<div class="page-break"></div>');
  });

  w.document.write('</body></html>');
  w.document.close();
  w.focus();
  w.print();
};
</script>
</body>
</html>
