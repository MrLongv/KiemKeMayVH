<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ“‹ Quáº£n lÃ½ Kiá»ƒm KÃª MÃ¡y May</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f6f8fa;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #0066cc;
    }
    button {
      background: #0066cc;
      color: #fff;
      border: none;
      padding: 10px 18px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
      margin: 5px 0;
    }
    button:hover {
      background: #004999;
    }
    input, select {
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: #fff;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    th {
      background: #0066cc;
      color: #fff;
    }
    #status {
      text-align: center;
      margin-top: 15px;
      font-weight: bold;
    }
    #fileInput {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>ğŸ“‹ Quáº£n lÃ½ Kiá»ƒm KÃª MÃ¡y May</h1>

  <input type="file" id="fileInput" accept=".xlsx, .xls" />
  <button onclick="uploadExcel()">ğŸ“¤ Nháº­p Excel lÃªn</button>
  <button onclick="syncToGoogleSheet()">ğŸ”„ Äá»“ng bá»™ lÃªn Google Sheet</button>
  <button onclick="loadFromGoogleSheet()">ğŸ“¥ Táº£i dá»¯ liá»‡u tá»« Google Sheet</button>

  <div id="status"></div>

  <table id="dataTable">
    <thead>
      <tr>
        <th>Sá»‘ Tháº»</th>
        <th>Sá»‘ MÃ¡y</th>
        <th>Loáº¡i MÃ¡y</th>
        <th>Vá»‹ TrÃ­</th>
        <th>Ghi ChÃº</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    const gasUrl = 'https://script.google.com/macros/s/AKfycbyV36oZEfMdC7Hc2EOqVL5r2A6qMPWvo5sU3qUdDhxbQ1hMPzwSYgdGnXPioOeZeWVs/exec';
    let excelData = [];

    // ğŸ“¤ Äá»c file Excel
    function uploadExcel() {
      const file = document.getElementById('fileInput').files[0];
      if (!file) return alert('Vui lÃ²ng chá»n file Excel!');
      const reader = new FileReader();
      reader.onload = (e) => {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
        excelData = rows.slice(1).map(r => ({
          soThe: r[0] || '',
          soMay: r[1] || '',
          loaiMay: r[2] || '',
          viTri: r[3] || '',
          ghiChu: r[4] || ''
        }));
        renderTable();
        showStatus('âœ… ÄÃ£ táº£i dá»¯ liá»‡u tá»« file Excel!');
      };
      reader.readAsArrayBuffer(file);
    }

    // ğŸ“‹ Hiá»ƒn thá»‹ dá»¯ liá»‡u ra báº£ng
    function renderTable() {
      const tbody = document.querySelector('#dataTable tbody');
      tbody.innerHTML = excelData.map(r => `
        <tr>
          <td>${r.soThe}</td>
          <td>${r.soMay}</td>
          <td>${r.loaiMay}</td>
          <td>${r.viTri}</td>
          <td>${r.ghiChu}</td>
        </tr>
      `).join('');
    }

    // ğŸ”„ Gá»­i dá»¯ liá»‡u lÃªn Google Sheet
    async function syncToGoogleSheet() {
      if (excelData.length === 0) return alert('ChÆ°a cÃ³ dá»¯ liá»‡u Ä‘á»ƒ Ä‘á»“ng bá»™!');
      showStatus('â³ Äang Ä‘á»“ng bá»™ lÃªn Google Sheet...');

      try {
        const res = await fetch(gasUrl, {
          method: 'POST',
          body: new URLSearchParams({ data: JSON.stringify(excelData) })
        });
        const result = await res.json();
        if (result.success) {
          showStatus(`âœ… ÄÃ£ Ä‘á»“ng bá»™ ${result.written} dÃ²ng dá»¯ liá»‡u lÃªn Google Sheet.`);
        } else {
          showStatus('âŒ Lá»—i: ' + result.message);
        }
      } catch (err) {
        showStatus('âŒ KhÃ´ng thá»ƒ káº¿t ná»‘i tá»›i Google Apps Script: ' + err.message);
      }
    }

    // ğŸ“¥ Táº£i dá»¯ liá»‡u tá»« Google Sheet
    async function loadFromGoogleSheet() {
      showStatus('â³ Äang táº£i dá»¯ liá»‡u tá»« Google Sheet...');
      try {
        const res = await fetch(gasUrl);
        const result = await res.json();
        if (result.success) {
          excelData = result.data;
          renderTable();
          showStatus('âœ… ÄÃ£ táº£i dá»¯ liá»‡u tá»« Google Sheet.');
        } else {
          showStatus('âŒ Lá»—i táº£i dá»¯ liá»‡u: ' + result.message);
        }
      } catch (err) {
        showStatus('âŒ KhÃ´ng thá»ƒ káº¿t ná»‘i tá»›i Google Apps Script: ' + err.message);
      }
    }

    function showStatus(msg) {
      document.getElementById('status').textContent = msg;
    }
  </script>
</body>
</html>
