<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Kiá»ƒm kÃª mÃ¡y may</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    margin: 0;
    background: #f3f4f6;
    color: #333;
  }
  header {
    background: #007bff;
    color: white;
    padding: 10px 16px;
    text-align: center;
    font-size: 20px;
    font-weight: 600;
  }
  main {
    padding: 16px;
  }
  button {
    margin: 4px;
    padding: 8px 12px;
    border: none;
    border-radius: 6px;
    background: #007bff;
    color: white;
    font-weight: 600;
    cursor: pointer;
  }
  button:hover {
    opacity: 0.9;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 16px;
    background: white;
    border-radius: 8px;
    overflow: hidden;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 6px 8px;
    text-align: left;
  }
  th {
    background: #f8f9fa;
  }
  tr:nth-child(even) {
    background: #fafafa;
  }
  #syncStatus {
    margin-top: 10px;
    font-weight: 600;
  }
</style>
</head>
<body>

<header>ğŸ“‹ Kiá»ƒm kÃª mÃ¡y may</header>

<main>
  <div>
    <button id="loadBtn">ğŸ“¥ Táº£i tá»« Google Sheet</button>
    <button id="uploadBtn">â˜ï¸ Äá»“ng bá»™ lÃªn Google Sheet</button>
    <span id="syncStatus"></span>
  </div>

  <table id="dataTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Sá»‘ tháº»</th>
        <th>Sá»‘ mÃ¡y</th>
        <th>Loáº¡i mÃ¡y</th>
        <th>Vá»‹ trÃ­</th>
        <th>Ghi chÃº</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- Dá»¯ liá»‡u hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y -->
    </tbody>
  </table>
</main>

<script>
const GAS_URL = 'https://script.google.com/macros/s/AKfycbyU_BsEvfaphUdDR_AlqGpM3ZZzjdRGSzJm--W2Yeqvd8Q3t0elZ3Vlu87WZV5ziR7R/exec';
const tableBody = document.getElementById('tableBody');
const syncStatus = document.getElementById('syncStatus');
const loadBtn = document.getElementById('loadBtn');
const uploadBtn = document.getElementById('uploadBtn');

// --- Táº£i dá»¯ liá»‡u tá»« Google Sheet ---
loadBtn.onclick = async () => {
  syncStatus.innerText = 'â³ Äang táº£i dá»¯ liá»‡u...';
  try {
    const res = await fetch(GAS_URL);
    const text = await res.text();
    console.log('GET response:', text);
    const data = JSON.parse(text);
    if (!data.success) throw new Error(data.message);

    tableBody.innerHTML = '';
    data.data.forEach((r, i) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${i + 1}</td>
        <td contenteditable="true">${r.soThe}</td>
        <td contenteditable="true">${r.soMay}</td>
        <td contenteditable="true">${r.loaiMay}</td>
        <td contenteditable="true">${r.viTri}</td>
        <td contenteditable="true">${r.ghiChu}</td>
      `;
      tableBody.appendChild(row);
    });
    syncStatus.innerText = 'âœ… ÄÃ£ táº£i ' + data.data.length + ' dÃ²ng tá»« Google Sheet';
  } catch (err) {
    console.error(err);
    syncStatus.innerText = 'âŒ Lá»—i khi táº£i dá»¯ liá»‡u: ' + err.message;
  }
};

// --- Gá»­i dá»¯ liá»‡u lÃªn Google Sheet ---
uploadBtn.onclick = async () => {
  const arr = [];
  tableBody.querySelectorAll('tr').forEach(r => {
    const t = r.querySelectorAll('td');
    arr.push({
      soThe: t[1]?.innerText || '',
      soMay: t[2]?.innerText || '',
      loaiMay: t[3]?.innerText || '',
      viTri: t[4]?.innerText || '',
      ghiChu: t[5]?.innerText || ''
    });
  });

  syncStatus.innerText = 'â˜ï¸ Äang Ä‘á»“ng bá»™ lÃªn Google Sheet...';
  try {
    const res = await fetch(GAS_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: 'data=' + encodeURIComponent(JSON.stringify(arr))
    });

    const text = await res.text();
    console.log('POST response:', text);
    const j = JSON.parse(text);

    if (j.success) {
      syncStatus.innerText = 'âœ… ÄÃ£ Ä‘á»“ng bá»™ ' + j.written + ' dÃ²ng lÃªn Google Sheet';
      alert('Äá»“ng bá»™ thÃ nh cÃ´ng!');
    } else {
      throw new Error(j.message);
    }
  } catch (err) {
    console.error(err);
    syncStatus.innerText = 'âŒ KhÃ´ng thá»ƒ káº¿t ná»‘i tá»›i GAS: ' + err.message;
  }
};
</script>

</body>
</html>
