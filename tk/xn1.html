<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>TK X∆∞·ªüng 1 - Theo d√µi nƒÉng su·∫•t</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: "Segoe UI", sans-serif;
  background:#f4f6f8;
  margin:0;
}
header{
  background:#003366;
  color:#fff;
  padding:12px 16px;
}
header b{font-size:18px}
.container{
  padding:16px;
}
select, input, button{
  padding:6px;
  margin:4px 0;
}
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
}
th{
  background:#e9eef3;
}
.msg{
  margin-top:8px;
  font-weight:bold;
}
.logout{
  float:right;
  background:#c0392b;
  color:#fff;
  border:none;
  padding:6px 10px;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <b>üìä TK ‚Äì X∆Ø·ªûNG 1</b>
  <button class="logout" onclick="logout()">ƒêƒÉng xu·∫•t</button>
</header>

<div class="container">

  <h3>üìÖ Th·ªëng k√™ theo ng√†y</h3>

  Ng√†y:
  <input type="date" id="ngay">

  <button onclick="loadData()">Xem d·ªØ li·ªáu</button>

  <table>
    <thead>
      <tr>
        <th>T·ªï</th>
        <th>Khung gi·ªù</th>
        <th>K·∫ø ho·∫°ch</th>
        <th>Th·ª±c t·∫ø</th>
        <th>%</th>
        <th>Nguy√™n nh√¢n</th>
      </tr>
    </thead>
    <tbody id="tb"></tbody>
  </table>

  <div class="msg" id="msg"></div>

</div>

<script>
/* ===== CONFIG ===== */
const API_URL = "https://nang-suat-may.hoalangiongxoai.workers.dev";

/* ===== CHECK LOGIN ===== */
const USER = JSON.parse(localStorage.getItem("USER"));

if(!USER){
  location.replace("../login.html");
}

if(USER.role !== "tk" || USER.xuong !== 1){
  location.replace("../login.html");
}

/* ===== DEFAULT DATE ===== */
document.getElementById("ngay").value =
  new Date().toISOString().slice(0,10);

/* ===== LOAD DATA ===== */
function loadData(){
  const ngay = document.getElementById("ngay").value;
  const tb = document.getElementById("tb");
  tb.innerHTML = "";
  document.getElementById("msg").innerText = "ƒêang t·∫£i...";

  fetch(API_URL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      action:"tkView",
      xuong:1,
      ngay
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(!res.success){
      document.getElementById("msg").innerText = res.msg;
      return;
    }

    if(res.data.length===0){
      document.getElementById("msg").innerText = "Kh√¥ng c√≥ d·ªØ li·ªáu";
      return;
    }

    res.data.forEach(r=>{
      const pct = r.ke_hoach_gio
        ? Math.round(r.thuc_te*100/r.ke_hoach_gio)
        : 0;

      tb.insertAdjacentHTML("beforeend",`
        <tr>
          <td>${r.to_nhom}</td>
          <td>${r.khung_gio}</td>
          <td>${r.ke_hoach_gio}</td>
          <td>${r.thuc_te}</td>
          <td>${pct}%</td>
          <td>${r.nguyen_nhan||""}</td>
        </tr>
      `);
    });

    document.getElementById("msg").innerText = "‚úÖ Ho√†n t·∫•t";
  })
  .catch(()=>{
    document.getElementById("msg").innerText = "‚ùå L·ªói k·∫øt n·ªëi server";
  });
}

/* ===== LOGOUT ===== */
function logout(){
  localStorage.removeItem("USER");
  location.replace("../login.html");
}

/* AUTO LOAD */
loadData();
</script>

</body>
</html>
