<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GDX1 ‚Äì Dashboard XN1</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
  :root{
    --bg:#f3f4f6;--card:#fff;--line:#d1d5db;--text:#111827;--muted:#6b7280;
    --head:#eef2f7;--head2:#e5e7eb;--primary:#2563eb;
    --good:#16a34a;--warn:#f59e0b;--bad:#dc2626;--shadow:0 10px 24px rgba(0,0,0,.06);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
  .topbar{position:sticky;top:0;z-index:30;background:linear-gradient(180deg,#0b1b3a,#0e2552);color:#fff;padding:12px 14px;box-shadow:0 10px 24px rgba(0,0,0,.18)}
  .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between}
  .brand b{display:block}
  .brand span{font-size:12px;opacity:.85}
  .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .ctl{display:flex;gap:6px;align-items:center;background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.18);padding:6px 8px;border-radius:12px}
  .ctl label{font-size:12px;opacity:.9}
  .ctl input,.ctl select{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.18);color:#fff;padding:6px 8px;border-radius:10px;outline:none;font-size:12px}
  .ctl select option{color:#111}
  .btn{border:none;background:var(--primary);color:#fff;padding:8px 10px;border-radius:12px;font-weight:800;cursor:pointer;font-size:12px}
  .btn.ghost{background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.20)}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .status{font-size:12px;opacity:.95;padding:6px 10px;background:rgba(255,255,255,.10);border:1px dashed rgba(255,255,255,.25);border-radius:12px;max-width:680px}

  .wrap{padding:14px}
  .kpi{display:grid;grid-template-columns:repeat(4,minmax(180px,1fr));gap:10px;margin-bottom:12px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);padding:12px}
  .card .label{font-size:12px;color:var(--muted)}
  .card .value{font-size:20px;font-weight:900;margin-top:4px}
  .card .sub{font-size:12px;color:var(--muted);margin-top:2px}

  .grid2{display:grid;grid-template-columns:1.2fr .8fr;gap:12px;margin-bottom:12px}
  .chartBox{height:300px}

  .tableWrap{background:#fff;border:1px solid var(--line);border-radius:16px;overflow:auto;box-shadow:var(--shadow)}
  table{width:max(1780px,100%);border-collapse:collapse;font-size:12.5px}
  th,td{border:1px solid var(--line);padding:6px;text-align:center;white-space:nowrap}
  thead tr:nth-child(1) th{background:var(--head);font-weight:900}
  thead tr:nth-child(2) th{background:var(--head2);font-weight:800}
  thead th{position:sticky;top:0;z-index:5}
  thead tr:nth-child(2) th{top:34px}
  tbody tr:nth-child(even) td{background:#fafafa}
  tfoot td{background:#f1f5f9;font-weight:900}

  .sticky1{position:sticky;left:0;z-index:6;background:#fff}
  .sticky2{position:sticky;left:62px;z-index:6;background:#fff}
  thead .sticky1, thead .sticky2{z-index:10;background:var(--head)}
  thead tr:nth-child(2) .sticky1, thead tr:nth-child(2) .sticky2{background:var(--head2)}

  .pct{font-weight:900}
  .pct.good{color:var(--good)} .pct.warn{color:var(--warn)} .pct.bad{color:var(--bad)}
  .calc{font-weight:900}
  .left{text-align:left}

  .miniTable table{width:100%;border-collapse:collapse;font-size:13px}
  .miniTable th,.miniTable td{border:1px solid var(--line);padding:8px;text-align:center}
  .miniTable th{background:var(--head);font-weight:900}
  .clickRow{cursor:pointer}
  .clickRow:hover td{background:#fff7ed !important}

  @media(max-width:980px){
    .kpi{grid-template-columns:repeat(2,1fr)}
    .grid2{grid-template-columns:1fr}
    table{width:max(1200px,100%)}
  }
</style>
</head>

<body>
<div class="topbar">
  <div class="row">
    <div class="brand">
      <b>üìà GDX1 ‚Äì DASHBOARD THEO D√ïI NƒÇNG SU·∫§T GI·ªú (XN1)</b>
      <span id="roleHint">‚Äî</span>
    </div>

    <div class="controls">
      <div class="ctl">
        <label>Ch·∫ø ƒë·ªô</label>
        <select id="mode">
          <option value="day">Ng√†y</option>
          <option value="week">Tu·∫ßn</option>
          <option value="month">Th√°ng</option>
          <option value="quarter">Qu√Ω</option>
          <option value="year">NƒÉm</option>
        </select>
      </div>
      <div class="ctl">
        <label>Ng√†y</label>
        <input type="date" id="date" />
      </div>
      <button class="btn ghost" onclick="logout()">ƒêƒÉng xu·∫•t</button>
      <button class="btn" onclick="reload()">T·∫£i d·ªØ li·ªáu</button>
      <div class="status" id="status">Ch∆∞a t·∫£i d·ªØ li·ªáu</div>
    </div>
  </div>
</div>

<div class="wrap">

  <!-- KPI -->
  <div class="kpi">
    <div class="card">
      <div class="label">T·ªïng SP</div>
      <div class="value" id="kpiSp">0</div>
      <div class="sub" id="kpiSpSub">‚Äî</div>
    </div>
    <div class="card">
      <div class="label">T·ªïng USD/TH (∆∞·ªõc t√≠nh)</div>
      <div class="value" id="kpiUsd">0.00</div>
      <div class="sub">USD/TH = T·ªïng SP * ƒê∆°n gi√°</div>
    </div>
    <div class="card">
      <div class="label">Hi·ªáu su·∫•t TB</div>
      <div class="value" id="kpiHs">0%</div>
      <div class="sub">Theo ƒêM ng√†y</div>
    </div>
    <div class="card">
      <div class="label">USD/gi·ªù cao nh·∫•t</div>
      <div class="value" id="kpiMax">0.00</div>
      <div class="sub">Ch·ªâ c√≥ ·ªü ch·∫ø ƒë·ªô Ng√†y</div>
    </div>
  </div>

  <!-- RANGE VIEW -->
  <div class="grid2" id="rangeArea" style="display:none">
    <div class="card">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
        <b>Xu h∆∞·ªõng theo ng√†y</b>
        <span style="font-size:12px;color:var(--muted)" id="rangeLabel">‚Äî</span>
      </div>
      <div class="chartBox"><canvas id="chart"></canvas></div>
    </div>

    <div class="card miniTable">
      <b>Danh s√°ch ng√†y (click ƒë·ªÉ xem chi ti·∫øt)</b>
      <div style="margin-top:10px;overflow:auto;max-height:320px">
        <table>
          <thead>
            <tr>
              <th>Ng√†y</th>
              <th>T·ªïng SP</th>
              <th>ƒêM ng√†y</th>
              <th>HS</th>
            </tr>
          </thead>
          <tbody id="rangeTbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- DAY DETAIL TABLE -->
  <div class="tableWrap" id="dayArea">
    <table id="tbl">
      <thead>
        <tr>
          <th class="sticky1" rowspan="2" style="min-width:62px;">T·ªî</th>
          <th class="sticky2" rowspan="2" style="min-width:170px;">M√É H√ÄNG</th>
          <th rowspan="2" style="min-width:90px;">SL KH</th>
          <th rowspan="2" style="min-width:90px;">ƒêM NG√ÄY</th>
          <th rowspan="2" style="min-width:90px;">ƒêM GI·ªú</th>
          <th rowspan="2" style="min-width:95px;">USD/QT</th>

          <th colspan="9">S·∫¢N L∆Ø·ª¢NG THEO GI·ªú</th>

          <th rowspan="2" style="min-width:90px;">T·ªîNG SP</th>
          <th rowspan="2" style="min-width:110px;">USD/TH</th>
          <th rowspan="2" style="min-width:105px;">HI·ªÜU SU·∫§T</th>

          <th colspan="2">LAO ƒê·ªòNG</th>

          <th rowspan="2" style="min-width:90px;">ƒêG</th>
          <th rowspan="2" style="min-width:100px;">TG/QT</th>
          <th rowspan="2" style="min-width:110px;">USD 80%</th>
          <th rowspan="2" style="min-width:110px;">USD 100%</th>
          <th rowspan="2" style="min-width:140px;">CHUY·ªÇN ƒê·ªîI/NG√ÄY</th>
          <th rowspan="2" style="min-width:220px;">GHI CH√ö</th>
        </tr>
        <tr id="hourHead"></tr>
      </thead>

      <tbody id="tbody"></tbody>

      <tfoot>
        <tr>
          <td class="sticky1 left" colspan="6" style="padding-left:10px;">T·ªîNG USD / GI·ªú</td>
          <td class="usdGio"></td><td class="usdGio"></td><td class="usdGio"></td><td class="usdGio"></td>
          <td class="usdGio"></td><td class="usdGio"></td><td class="usdGio"></td><td class="usdGio"></td><td class="usdGio"></td>
          <td colspan="11"></td>
        </tr>
        <tr>
          <td class="left" colspan="24" style="padding-left:10px;">T·ªîNG USD CU·ªêI NG√ÄY</td>
          <td id="usdNgay">0.00</td>
        </tr>
      </tfoot>
    </table>
  </div>

</div>

<script>
/* ================== CONFIG ================== */
const API_URL = "https://nang-suat-may.hoalangiongxoai.workers.dev";
const XUONG = 1;
const TO_LIST = [1,3,5,7,9];
const HOURS = ["7-8","8-9","9-10","10-11","12-13","13-14","14-15","15-16","16-17"];
const HOURS_COUNT = 9;

/* ================== SESSION ================== */
const KEY="NS_SESSION";
function getSess(){ try{return JSON.parse(localStorage.getItem(KEY)||"null")}catch{return null} }
function mustLogin(){
  const s=getSess();
  if(!s || !s.token){ location.href="../login.html"; return null; }
  return s;
}
function logout(){ localStorage.removeItem(KEY); location.href="../login.html"; }

/* ================== UTIL ================== */
async function apiPost(payload){
  const r = await fetch(API_URL,{ method:"POST", headers:{ "Content-Type":"application/json" }, body:JSON.stringify(payload) });
  return await r.json();
}
function setStatus(t){ document.getElementById("status").innerText = t; }
function todayISO(){
  const d=new Date(); const mm=String(d.getMonth()+1).padStart(2,"0"); const dd=String(d.getDate()).padStart(2,"0");
  return `${d.getFullYear()}-${mm}-${dd}`;
}
function toNum(v){ const n=Number(String(v??"").replaceAll(",","").trim()); return Number.isFinite(n)?n:0; }
function fmt0(n){ return String(Math.round(Number(n)||0)); }
function fmt1(n){ return (Number(n)||0).toFixed(1); }
function fmt2(n){ return (Number(n)||0).toFixed(2); }
function escapeHtml(s){
  return String(s??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
}
function pctClass(hs){
  hs = Number(hs)||0;
  if(hs>=95) return "good";
  if(hs>=80) return "warn";
  return "bad";
}

/* ================== RANGE ================== */
function getRange(mode, dateStr){
  const d = new Date(dateStr+"T00:00:00");
  const yyyy = d.getFullYear();
  const mm = d.getMonth();
  const dd = d.getDate();
  const toISO = (x)=>{
    const m=String(x.getMonth()+1).padStart(2,"0");
    const da=String(x.getDate()).padStart(2,"0");
    return `${x.getFullYear()}-${m}-${da}`;
  };

  if(mode === "day") return { from: dateStr, to: dateStr, label:`Ng√†y ${dateStr}` };
  if(mode === "week"){
    const day = (d.getDay()+6)%7; // monday=0
    const start = new Date(d); start.setDate(dd - day);
    const end = new Date(start); end.setDate(start.getDate()+6);
    return { from: toISO(start), to: toISO(end), label:`Tu·∫ßn ${toISO(start)} ‚Üí ${toISO(end)}` };
  }
  if(mode === "month"){
    const start = new Date(yyyy, mm, 1);
    const end = new Date(yyyy, mm+1, 0);
    return { from: toISO(start), to: toISO(end), label:`Th√°ng ${yyyy}-${String(mm+1).padStart(2,"0")}` };
  }
  if(mode === "quarter"){
    const q = Math.floor(mm/3);
    const start = new Date(yyyy, q*3, 1);
    const end = new Date(yyyy, q*3+3, 0);
    return { from: toISO(start), to: toISO(end), label:`Qu√Ω ${q+1}/${yyyy}` };
  }
  const start = new Date(yyyy, 0, 1);
  const end = new Date(yyyy, 12, 0);
  return { from: toISO(start), to: toISO(end), label:`NƒÉm ${yyyy}` };
}

/* ================== STATE ================== */
let S = null;
let chart = null;

/* ================== INIT ================== */
document.getElementById("date").value = todayISO();
document.getElementById("hourHead").innerHTML = HOURS.map(h=>`<th>${h}</th>`).join("") + `<th>TT</th><th>SƒêC</th>`;

S = mustLogin();
initAuthAndLoad();

/* ================== AUTH + LOAD ================== */
function initAuthAndLoad(){
  if(!S) return;

  const role = String(S.role || "").trim();
  const xu = (S.xuong === null || S.xuong === undefined || S.xuong === "") ? NaN : Number(S.xuong);

  // debug status ƒë·ªÉ b·∫°n nh√¨n th·∫•y session th·ª±c t·∫ø
  setStatus(`SESSION: user=${S.username} role=${role} xuong=${S.xuong} to=${S.to_nhom}`);

  const ok = (role === "gdx" && xu === XUONG) || (role === "gdc");
  if(!ok){
    document.getElementById("roleHint").innerText =
      `‚õî Kh√¥ng ƒë√∫ng quy·ªÅn: role=${role} xuong=${S.xuong} to=${S.to_nhom} (c·∫ßn gdx xuong ${XUONG})`;
    setStatus(`BLOCKED: role=${role} xu=${xu} need=${XUONG}`);
    return;
  }

  document.getElementById("roleHint").innerText =
    (role === "gdc")
      ? `üëÄ GƒêC: ƒëang xem XN${XUONG}`
      : `üëÄ GƒêX1: ch·ªâ xem ‚Ä¢ T√†i kho·∫£n: ${S.username}`;

  reload();
}

/* ================== MAIN ================== */
async function reload(){
  S = mustLogin(); if(!S) return;

  const role = String(S.role || "").trim();
  const xu = (S.xuong === null || S.xuong === undefined || S.xuong === "") ? NaN : Number(S.xuong);
  const ok = (role === "gdx" && xu === XUONG) || (role === "gdc");
  if(!ok){
    setStatus(`BLOCKED: role=${role} xu=${xu} need=${XUONG}`);
    return;
  }

  const mode = document.getElementById("mode").value;
  const date = document.getElementById("date").value;
  const range = getRange(mode, date);

  if(mode === "day"){
    document.getElementById("rangeArea").style.display = "none";
    document.getElementById("dayArea").style.display = "block";
    await loadDayDetail(date);
  } else {
    document.getElementById("dayArea").style.display = "none";
    document.getElementById("rangeArea").style.display = "grid";
    document.getElementById("rangeLabel").innerText = `${range.label} ‚Ä¢ XN${XUONG}`;
    await loadRangeSummary(range.from, range.to);
  }
}

function setKpi(sp, usd, hs, maxUsdGio, spSub="‚Äî"){
  document.getElementById("kpiSp").innerText = fmt0(sp);
  document.getElementById("kpiUsd").innerText = fmt2(usd);
  document.getElementById("kpiHs").innerText = fmt1(hs) + "%";
  document.getElementById("kpiMax").innerText = fmt2(maxUsdGio);
  document.getElementById("kpiSpSub").innerText = spSub;
}

/* ================== DAY DETAIL ================== */
async function loadDayDetail(ngay){
  setStatus(`ƒêang t·∫£i chi ti·∫øt ng√†y ${ngay}...`);

  const res = await apiPost({ action:"getTkXuongDay", token:S.token, ngay, xuong:XUONG });
  if(!res.success){
    setStatus("L·ªói: " + (res.msg||""));
    document.getElementById("tbody").innerHTML = "";
    setKpi(0,0,0,0,"‚Äî");
    return;
  }

  const map = new Map();
  (res.rows||[]).forEach(r => map.set(Number(r.to_nhom), r));
  const rows = TO_LIST.map(to=>{
    const r = map.get(to) || { to_nhom:to, hours:Array(HOURS_COUNT).fill(0) };
    if(!Array.isArray(r.hours)) r.hours = Array(HOURS_COUNT).fill(0);
    if(r.hours.length !== HOURS_COUNT) r.hours = Array(HOURS_COUNT).fill(0);
    return r;
  });

  renderDayRows(rows);
  calcFooterAndKpi(rows);

  setStatus(`ƒê√£ t·∫£i ‚Ä¢ ${ngay} ‚Ä¢ XN${XUONG}`);
}

function renderDayRows(rows){
  const tb = document.getElementById("tbody");
  tb.innerHTML = rows.map(r=>{
    const hours = r.hours || Array(HOURS_COUNT).fill(0);
    const tongSP = hours.reduce((a,b)=>a+toNum(b),0);

    const dmNgay = toNum(r.dinh_muc_ngay);
    const dg = toNum(r.don_gia);

    const dmGio = (toNum(r.dinh_muc_gio) > 0) ? toNum(r.dinh_muc_gio) : (dmNgay ? dmNgay/9 : 0);
    const usdQt = (toNum(r.usd_quy_trinh) > 0) ? toNum(r.usd_quy_trinh) : (dmNgay*dg);

    const usdTh = tongSP * dg;
    const hs = dmNgay ? (tongSP/dmNgay*100) : 0;

    const usd100 = dmNgay * dg;
    const usd80 = usd100 * 0.8;

    return `
      <tr data-to="${r.to_nhom}">
        <td class="sticky1"><b>${r.to_nhom}</b></td>

        <td class="sticky2 left" style="padding-left:8px">${escapeHtml(r.ma_hang||"")}</td>
        <td>${fmt0(r.so_luong_ke_hoach||0)}</td>
        <td>${fmt0(dmNgay)}</td>
        <td>${fmt2(dmGio)}</td>
        <td>${fmt2(usdQt)}</td>

        ${hours.map(v=>`<td>${fmt0(v||0)}</td>`).join("")}

        <td class="calc">${fmt0(tongSP)}</td>
        <td class="calc">${fmt2(usdTh)}</td>
        <td class="pct ${pctClass(hs)}">${fmt1(hs)}%</td>

        <td>${fmt0(r.lao_dong_thuc_te||0)}</td>
        <td>${fmt0(r.lao_dong_chuyen||0)}</td>

        <td>${fmt2(dg)}</td>
        <td>${fmt2(r.thoi_gian_giay||0)}</td>

        <td class="calc">${fmt2(usd80)}</td>
        <td class="calc">${fmt2(usd100)}</td>

        <td>${fmt0(r.chuyen_doi_ngay||0)}</td>

        <td class="left" style="white-space:normal;min-width:220px;padding-left:8px">${escapeHtml(r.ghi_chu||"")}</td>
      </tr>
    `;
  }).join("");
}

function calcFooterAndKpi(rows){
  let tongUsdNgay=0, tongSpAll=0, hsSum=0, hsCount=0;
  const usdGio = Array(HOURS_COUNT).fill(0);

  rows.forEach(r=>{
    const hours = r.hours || Array(HOURS_COUNT).fill(0);
    const tongSP = hours.reduce((a,b)=>a+toNum(b),0);
    tongSpAll += tongSP;

    const dg = toNum(r.don_gia);
    hours.forEach((v,i)=> usdGio[i] += toNum(v)*dg);

    const usdTh = tongSP*dg;
    tongUsdNgay += usdTh;

    const dmNgay = toNum(r.dinh_muc_ngay);
    const hs = dmNgay ? (tongSP/dmNgay*100) : 0;
    hsSum += hs; hsCount++;
  });

  document.querySelectorAll(".usdGio").forEach((td,i)=> td.innerText = fmt2(usdGio[i]||0));
  document.getElementById("usdNgay").innerText = fmt2(tongUsdNgay);

  const maxUsdGio = usdGio.length ? Math.max(...usdGio) : 0;
  const hsTb = hsCount ? (hsSum/hsCount) : 0;

  setKpi(tongSpAll, tongUsdNgay, hsTb, maxUsdGio, "Theo ng√†y ƒëang ch·ªçn");
}

/* ================== RANGE SUMMARY ================== */
async function loadRangeSummary(from, to){
  setStatus(`ƒêang t·∫£i t·ªïng h·ª£p ${from} ‚Üí ${to}...`);

  const res = await apiPost({ action:"getDayRangeByXuong", token:S.token, xuong:XUONG, from, to });
  if(!res.success){
    setStatus("L·ªói: " + (res.msg||""));
    document.getElementById("rangeTbody").innerHTML = "";
    if(chart){ chart.destroy(); chart=null; }
    setKpi(0,0,0,0,"‚Äî");
    return;
  }

  const data = res.data || [];
  const labels = data.map(x=>String(x.ngay));
  const sp = data.map(x=>toNum(x.tong_sp));
  const ke = data.map(x=>toNum(x.dinh_muc_ngay));
  const hs = data.map((x,i)=> (ke[i]>0 ? (sp[i]/ke[i]*100) : 0));

  const sumSp = sp.reduce((a,b)=>a+b,0);
  const sumKe = ke.reduce((a,b)=>a+b,0);
  const hsAll = sumKe>0 ? (sumSp/sumKe*100) : 0;

  // Range mode: USD kh√¥ng t√≠nh ch√≠nh x√°c theo kho·∫£ng (thi·∫øu t·ªïng ƒë∆°n gi√° theo ng√†y), n√™n ƒë·ªÉ 0
  setKpi(sumSp, 0, hsAll, 0, `T·ªïng ${from} ‚Üí ${to}`);

  // Table
  const tb = document.getElementById("rangeTbody");
  tb.innerHTML = data.map((r, idx)=>{
    const hsRow = hs[idx];
    return `
      <tr class="clickRow" onclick="jumpToDay('${escapeHtml(r.ngay)}')">
        <td><b>${escapeHtml(r.ngay)}</b></td>
        <td>${fmt0(r.tong_sp||0)}</td>
        <td>${fmt0(r.dinh_muc_ngay||0)}</td>
        <td class="pct ${pctClass(hsRow)}">${fmt1(hsRow)}%</td>
      </tr>
    `;
  }).join("") || `<tr><td colspan="4" class="left" style="padding-left:10px;color:#6b7280">Kh√¥ng c√≥ d·ªØ li·ªáu.</td></tr>`;

  // Chart
  const ctx = document.getElementById("chart");
  if(chart){ chart.destroy(); }
  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [
        { label: "T·ªïng SP", data: sp, yAxisID: "ySp", tension: 0.25 },
        { label: "Hi·ªáu su·∫•t (%)", data: hs, yAxisID: "yHs", tension: 0.25 }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: "index", intersect: false },
      scales: {
        ySp: { type:"linear", position:"left", title:{ display:true, text:"SP" } },
        yHs: { type:"linear", position:"right", title:{ display:true, text:"%" }, grid:{ drawOnChartArea:false } }
      }
    }
  });

  setStatus(`ƒê√£ t·∫£i t·ªïng h·ª£p ‚Ä¢ ${from} ‚Üí ${to} ‚Ä¢ XN${XUONG}`);
}

function jumpToDay(ngay){
  document.getElementById("mode").value = "day";
  document.getElementById("date").value = ngay;
  reload();
}

/* ================== EVENTS ================== */
document.getElementById("mode").addEventListener("change", reload);
document.getElementById("date").addEventListener("change", reload);
</script>
</body>
</html>
